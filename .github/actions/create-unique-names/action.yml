name: "Create Globally Unique Names For Resource Group"
description: "Create unique names for Azure resources"
inputs:
  resourceGroupName:
    description: "The name of the resource group"
    required: true
outputs:
  uniqueString:
    description: "The unique string generated from the resource group ID"
    value: ${{ steps.create_unique_names.outputs.UNIQUE_STRING }}
  acrName:
    description: "The name of the Azure Container Registry"
    value: ${{ steps.create_unique_names.outputs.ACR_NAME }}
  aksName:
    description: "The name of the AKS cluster"
    value: ${{ steps.create_unique_names.outputs.AKS_NAME }}
  frontDoorEndpointName:
    description: "The name of the Front Door endpoint"
    value: ${{ steps.create_unique_names.outputs.FRONT_DOOR_ENDPOINT_NAME }}
  logAnalyticsWorkspaceName:
    description: "The name of the Log Analytics Workspace"
    value: ${{ steps.create_unique_names.outputs.LOG_ANALYTICS_WORKSPACE_NAME }}
  applicationInsightsName:
    description: "The name of the Application Insights resource"
    value: ${{ steps.create_unique_names.outputs.APPLICATION_INSIGHTS_NAME }}
  postgresServerName:
    description: "The name of the PostgreSQL Flexible Server"
    value: ${{ steps.create_unique_names.outputs.POSTGRES_SERVER_NAME }}
runs:
  using: "composite"
  steps:
    - name: Create Globally Unique Names For Resource Group
      id: create_unique_names
      shell: pwsh
      run: |
        $resourceGroupId = (Get-AzResourceGroup -Name ${{ inputs.resourceGroupName }}).ResourceId
        $uniqueString=$(./tools/ArmUniqueStringGenerator.ps1 -InputStringValue $resourceGroupId)
        echo "UNIQUE_STRING=$uniqueString" | Out-File -FilePath $env:GITHUB_OUTPUT -Encoding utf8 -Append
        $acrName="acr${uniqueString}"
        echo "ACR_NAME=$acrName" | Out-File -FilePath $env:GITHUB_OUTPUT -Encoding utf8 -Append
        $aksName="aks-${uniqueString}"
        echo "AKS_NAME=$aksName" | Out-File -FilePath $env:GITHUB_OUTPUT -Encoding utf8 -Append
        $frontDoorEndpointName="afd-${uniqueString}"
        echo "FRONT_DOOR_ENDPOINT_NAME=$frontDoorEndpointName" | Out-File -FilePath $env:GITHUB_OUTPUT -Encoding utf8 -Append
        $logAnalyticsWorkspaceName="law-${uniqueString}"
        echo "LOG_ANALYTICS_WORKSPACE_NAME=$logAnalyticsWorkspaceName" | Out-File -FilePath $env:GITHUB_OUTPUT -Encoding utf8 -Append
        $applicationInsightsName="ai-${uniqueString}"
        echo "APPLICATION_INSIGHTS_NAME=$applicationInsightsName" | Out-File -FilePath $env:GITHUB_OUTPUT -Encoding utf8 -Append
        $postgresServerName="pgdb-${uniqueString}"
        echo "POSTGRES_SERVER_NAME=$postgresServerName" | Out-File -FilePath $env:GITHUB_OUTPUT -Encoding utf8 -Append
