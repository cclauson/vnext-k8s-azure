name: "Create Globally Unique Names For Resource Group"
description: "Create unique names for Azure resources"
inputs:
  resourceGroupName:
    description: "The name of the resource group"
    required: true
outputs:
  uniqueString:
    description: "The unique string generated from the resource group ID"
    value: ${{ steps.create_unique_names.outputs.UNIQUE_STRING }}
  acrName:
    description: "The name of the Azure Container Registry"
    value: ${{ steps.create_unique_names.outputs.ACR_NAME }}
  aksName:
    description: "The name of the AKS cluster"
    value: ${{ steps.create_unique_names.outputs.AKS_NAME }}
runs:
  using: "composite"
  steps:
    - name: Create Globally Unique Names For Resource Group
      id: create_unique_names
      shell: pwsh
      run: |
        $resourceGroupId = (Get-AzResourceGroup -Name ${{ inputs.resourceGroupName }}).ResourceId
        $uniqueString=$(./tools/ArmUniqueStringGenerator.ps1 -InputStringValue $resourceGroupId)
        echo "UNIQUE_STRING=$uniqueString" | Out-File -FilePath $env:GITHUB_OUTPUT -Encoding utf8 -Append
        $acrName="acr${uniqueString}"
        echo "ACR_NAME=$acrName" | Out-File -FilePath $env:GITHUB_OUTPUT -Encoding utf8 -Append
        $aksName="aks-${uniqueString}"
        echo "AKS_NAME=$aksName" | Out-File -FilePath $env:GITHUB_OUTPUT -Encoding utf8 -Append
